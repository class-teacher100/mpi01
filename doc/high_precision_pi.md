# 高精度円周率計算の検討

## 現在の方法の限界

現在の `pi_mpi.c` には2つの根本的な制約がある。

| 制約 | 説明 |
|------|------|
| double型の精度 | IEEE 754倍精度は約15-16桁が限界 |
| 数値積分の収束速度 | 中点法は1桁増やすのに計算量が10倍必要 |

分割数をいくら増やしても15桁を超えることは不可能。

## 高精度計算に必要な要素

### 1. 多倍長演算ライブラリ

| ライブラリ | 特徴 |
|-----------|------|
| GMP | 最も広く使われる。整数・有理数・浮動小数点をサポート |
| MPFR | GMPベース。正確な丸めを保証する浮動小数点演算 |

インストール:
```bash
sudo apt-get install libgmp-dev libmpfr-dev
```

### 2. 高速収束アルゴリズム

| アルゴリズム | 収束速度 | 並列化適性 | 実装難易度 |
|-------------|---------|-----------|-----------|
| BBP公式 | 1項≒1桁 | 非常に高い | 低 |
| Machinの公式 | 1項≒1桁 | 高い | 低 |
| Chudnovsky | 1項≒14桁 | 中程度 | 高 |
| Gauss-Legendre | 反復で桁が倍増 | 低い | 中 |

## 推奨: BBP公式によるMPI並列化

### 選定理由

- 各項が完全に独立 → MPI並列化に最適
- 通信オーバーヘッドが最小（最後の集約のみ）
- 実装が比較的シンプル
- 教育目的に適している

### BBP公式

$$
\pi = \sum_{k=0}^{\infty} \frac{1}{16^k} \left( \frac{4}{8k+1} - \frac{2}{8k+4} - \frac{1}{8k+5} - \frac{1}{8k+6} \right)
$$

### 並列化戦略

各プロセスが異なる項を担当:

```
プロセス0: k = 0, 4, 8, 12, ...
プロセス1: k = 1, 5, 9, 13, ...
プロセス2: k = 2, 6, 10, 14, ...
プロセス3: k = 3, 7, 11, 15, ...
```

## 最高性能を目指す場合: Chudnovsky + Binary Splitting

### Chudnovsky公式

世界記録（31.4兆桁、2019年）に使用された公式:

$$
\frac{1}{\pi} = 12 \sum_{k=0}^{\infty} \frac{(-1)^k (6k)! (13591409 + 545140134k)}{(3k)!(k!)^3 \cdot 640320^{3k+3/2}}
$$

### 特徴

- 1項あたり約14桁収束（BBPの14倍効率的）
- Binary Splitting法で分割統治による並列化
- 実装は複雑だが、100万桁以上を目指すなら必須

## 目標桁数別の推奨アプローチ

| 目標桁数 | 推奨アプローチ |
|---------|---------------|
| 100〜1,000桁 | BBP + GMP + MPI（学習に最適） |
| 1,000〜100万桁 | Machin系公式 + MPFR + MPI |
| 100万桁以上 | Chudnovsky + Binary Splitting + GMP + MPI |
